 
\documentclass[a4paper]{article}
\usepackage{pgfplots}
\usepackage{tikz}
\usepackage{import}
\usepackage[font=scriptsize,labelfont=bf]{caption}
\usepackage{array}
\usepackage{amsmath}
\usepackage{listings}
\lstset{basicstyle=\ttfamily}
\begin{document}


\newcommand*{\figuretitle}[1]{%
    {\centering%   <--------  will only affect the title because of the grouping (by the
    \textbf{#1}%              braces before \centering and behind \medskip). If you remove
    \par\medskip}%            these braces the whole body of a {figure} env will be centered.
}


\title{Raxml repeats benchmarks}
\maketitle


\section{Execution time}

\noindent We run raxml for each dataset with and without the repeats option, and compare the execution times.\\


\noindent Speedup is calculated as follow :  
$$ speedup = \frac{time_{tipinner}}{time_{repeats}}$$

When we don't indicate times, the cluster cancelled the jobs before the end (after 24h). We then compare the speedup at the last reached step. \newline

When we write "diverged", the runs diverged. In this case we write the speedup at the last common step.

Raxml commands used (repeats, repeats with jemalloc, tipinner):
\lstset{language=sh}
\begin{lstlisting}
  $ LD_PRELOAD=libjemalloc.so mpirun ./raxml-ng-mpi --seed=42 --msa data.phy --model data.part
   --simd AVX --threads 1  --search --repeats on
  $ LD_PRELOAD=libjemalloc.so mpirun ./raxml-ng-mpi --seed=42 --msa data.phy --model data.part
   --simd AVX --threads 1  --search 
\end{lstlisting}


\begin{tabular}{|l|l|l|l|c|c|l|l|c|}
\hline dataset                    & taxas & sites    & partitions & type & threads & $time_{reps}$ & $time_{ti}$ & speedup\\
\hline 404                        & 404   &  7444    & 11         & DNA  & 16 & 457s     &  755s     & 1.65  \\
\hline 1kite\_science             & 144   &  371434  & 50         & DNA  & 16 & 9351s    &  13311s   & 1.42  \\
\hline 1kite\_hyme                & 174   &  2248590 & 4116       & DNA  & 64 & 21663s   &  29971s   & 1.38 \\
\hline Antl\_1\_1\_nt             & 40    &  522173  & 658        & DNA  & 16 & 1254s    &  1668s    & 1.3  \\
\hline Antl\_1\_1\_aa             & 40    &  762438  & 659        & prot & 32 & 4966s    &  6080s    & 1.2\\
\hline para\_1\_nt                & 193   &  1514275 & 3714       & DNA  & 64 & diverged &  diverged & 1.35  \\
\hline 
\end{tabular}\newline
\newline


\section{Scalability and load balancing}

\begin{itemize}
\item "speedup" is the speedup between tipinner and repeats.
\item "rep" is repeats
\item "time lost" is the time lost because of bad load balancing
\end{itemize}

1kyte\_hyme

\begin{tabular}{|c|c|c|c|c|c|c|c|}
\hline threads & sites/thread & seq time & seq time rep & time lost & time lost rep & speedup \\
\hline
\end{tabular} \newline


404

\begin{tabular}{|c|c|c|c|c|c|c|c|}
\hline threads & sites/thread & seq time & seq time rep & time lost & time lost rep & speedup \\
\hline 4 & 1861 & 7816s & 5100s & 2.37\% & 2.83\% & 1.53 \\
\hline 8 & 930 & 11608s & 6472s & 5.14\% & 4.43\% & 1.79 \\
\hline 16 & 465 & 12016s & 7392s & 5.73\% & 6.49\% & 1.62 \\
\hline
\end{tabular} \newline


antl\_1\_1\_nt2

\begin{tabular}{|c|c|c|c|c|c|c|c|}
\hline threads & sites/thread & seq time & seq time rep & time lost & time lost rep & speedup \\
\hline 16 & 32635 & 26416s & 20080s & 0.43\% & 0.90\% & 1.31 \\
\hline 64 & 8158 & 25280s & 18816s & 1.31\% & 1.65\% & 1.34 \\
\hline 256 & 2039 & 31488s & 26112s & 3.32\% & 4.89\% & 1.20 \\
\hline
\end{tabular} \newline


kyte

\begin{tabular}{|c|c|c|c|c|c|c|c|}
\hline threads & sites/thread & seq time & seq time rep & time lost & time lost rep & speedup \\
\hline 16 & 23214 & 213408s & 148688s & 1.21\% & 2.03\% & 1.43 \\
\hline 64 & 5803 & 168192s & 119616s & 2.00\% & 8.08\% & 1.40 \\
\hline
\end{tabular} \newline



\section{Load balancing}

We define
$$busy\ ratio = (1 - \frac{waiting\ time\ in\ reduce\ operations}{elapsed\ time}) * 100$$

It directly gives the speedup we could get from a perfect load balancing.\newline

I will recompute this table later with mpi.


%\begin{tabular}{|l|c|c|c|c|c|c|c|}
%\hline dataset                    & taxas & sites    & parts & type  & $ratio_{repeats}$ & $ratio_{jemrepeats}$ & $ratio_{tipinner}$\\
%\hline 404                        & 404   &  7444    & 11    & DNA  & 86\%     & 85\%   & 86\%  \\
%\hline 1kite\_science             & 144   &  371434  & 50    & DNA  & 83\%     & 92\%    & 83\%  \\
%\hline 1kite\_hyme                & 174   &  2248590 & 4116  & DNA  & 93\%     & ?\%    & 92\%  \\
%\hline Antl\_1\_1\_nt             & 40    &  522173  & 658   & DNA  & ?\%      & 96\%    & ?\%  \\
%\hline Antl\_1\_1\_aa             & 40    &  762438  & 659   & prot & 96\%     & 93\%    & 89\%  \\
%\hline para\_1\_nt                & 193   &  1514275 & 3714  & DNA  & 92\%     & ?\%    & 90\%  \\
%\hline 
%\end{tabular}\newline
%\newline


%para\_1\_aa ne passe pas en memoire

\end{document}