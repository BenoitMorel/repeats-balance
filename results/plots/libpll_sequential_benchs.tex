  \documentclass[a4paper]{article}
\usepackage{pgfplots}
\usepackage{tikz}
\usepackage{import}
\usepackage[font=scriptsize,labelfont=bf]{caption}
\usepackage{array}

\begin{document}


\newcommand*{\figuretitle}[1]{%
    {\centering%   <--------  will only affect the title because of the grouping (by the
    \textbf{#1}%              braces before \centering and behind \medskip). If you remove
    \par\medskip}%            these braces the whole body of a {figure} env will be centered.
}


\title{Libpll sequential benchmarks}
\maketitle


\section{Benchmark description}

The following benchmarks compare several libpll implementations with different modes. They measure the execution time of a full likelihood computation on a fixed tree. To avoid measuring the initialization part, we repeat several times  \texttt{pll\_update\_partials} and \texttt{pll\_compute\_edge\_likelihood} on the same partitions and tree.

\begin{itemize}
\item xflouris means that the implentation used is this one: \\ https://github.com/xflouris/libpll.
\item bmorel means that the implementation  used is this one: \\ https://github.com/BenoitMorel/libpll. It supports sites repeats, and the data structure used is a bit different from xflouris (even without sites repeats): CLVs are not assumed to be sorted by sites, and an additional lookup table is used to access them in most of the core functions.
\item bmorel2 is a (temporary) hacked version of bmorel where I do not use the new lookup structure for the scalers, because I think it slows down the execution, and the speed up with the sites repeats is not great.
\item default mode means that the option \texttt{PLL\_ATTRIB\_PATTERN\_TIP} and \texttt{PLL\_ATTRIB\_SITES\_REPEATS} are unset.
\item tip pattern means that the option \texttt{PLL\_ATTRIB\_PATTERN\_TIP} is set.
\item sites repeats means that the option \texttt{PLL\_ATTRIB\_SITES\_REPEATS} is set.
\item M is the size of the buffer allocated to compute the sites repeats class identifiers. When it increases, more nodes can benefit from sites repeats. 
\end{itemize}

\newpage

\section{Summary of the results}



Without sites repeats, bmorel's implementation with the additional lookup table can be from 0\% to 10\% slower than xflouris' one, especially with SSE and AVX architectures. bmorel2's hacked implementation (so without using the lookup for the scalers) is better, but can also be slower than xflouris'one.\\

In all versions, the tip pattern mode is around 1.5 faster than the default mode.\\

The sites repeats speed up is between 2 and 5 times faster than the tip pattern mode. 
It depends on :
\begin{itemize}
\item the dataset 
\item the architecture : it performs a bit better with CPU than with AVX and SSE
\item the size of the sites repeats matrix buffer (M) : it performs better when the size increases
\end{itemize}


\newpage

\section{Benchmark}


%\begin{figure}[!htb]
%\figuretitle{CPU architecture, 500 iterations}
%\subimport{../sequential_benchs/}{bench_500_iterationscpu.tex}
%\end{figure}
%\begin{figure}[!htb]
%\figuretitle{SSE architecture, 500 iterations}
%\subimport{../sequential_benchs/}{bench_500_iterationssse.tex}
%\end{figure}
\begin{figure}[!htb]
\figuretitle{AVX architecture, 500 iterations}
\subimport{../sequential_benchs/}{bench_500_iterationsavx.tex}
\end{figure}

\end{document}